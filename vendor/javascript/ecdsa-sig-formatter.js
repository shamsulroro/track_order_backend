import r from"safe-buffer";var e={};function getParamSize(r){var e=(r/8|0)+(r%8===0?0:1);return e}var o={ES256:getParamSize(256),ES384:getParamSize(384),ES512:getParamSize(521)};function getParamBytesForAlg(r){var e=o[r];if(e)return e;throw new Error('Unknown algorithm "'+r+'"')}e=getParamBytesForAlg;var a=e;var t={};var n=r.Buffer;var f=a;var i=128,s=0,u=32,c=16,v=2,l=c|u|s<<6,g=v|s<<6;function base64Url(r){return r.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function signatureAsBuffer(r){if(n.isBuffer(r))return r;if("string"===typeof r)return n.from(r,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function derToJose(r,e){r=signatureAsBuffer(r);var o=f(e);var a=o+1;var t=r.length;var s=0;if(r[s++]!==l)throw new Error('Could not find expected "seq"');var u=r[s++];u===(1|i)&&(u=r[s++]);if(t-s<u)throw new Error('"seq" specified length of "'+u+'", only "'+(t-s)+'" remaining');if(r[s++]!==g)throw new Error('Could not find expected "int" for "r"');var c=r[s++];if(t-s-2<c)throw new Error('"r" specified length of "'+c+'", only "'+(t-s-2)+'" available');if(a<c)throw new Error('"r" specified length of "'+c+'", max of "'+a+'" is acceptable');var v=s;s+=c;if(r[s++]!==g)throw new Error('Could not find expected "int" for "s"');var d=r[s++];if(t-s!==d)throw new Error('"s" specified length of "'+d+'", expected "'+(t-s)+'"');if(a<d)throw new Error('"s" specified length of "'+d+'", max of "'+a+'" is acceptable');var p=s;s+=d;if(s!==t)throw new Error('Expected to consume entire buffer, but "'+(t-s)+'" bytes remain');var w=o-c,h=o-d;var m=n.allocUnsafe(w+c+h+d);for(s=0;s<w;++s)m[s]=0;r.copy(m,s,v+Math.max(-w,0),v+c);s=o;for(var E=s;s<E+h;++s)m[s]=0;r.copy(m,s,p+Math.max(-h,0),p+d);m=m.toString("base64");m=base64Url(m);return m}function countPadding(r,e,o){var a=0;while(e+a<o&&0===r[e+a])++a;var t=r[e+a]>=i;t&&--a;return a}function joseToDer(r,e){r=signatureAsBuffer(r);var o=f(e);var a=r.length;if(a!==2*o)throw new TypeError('"'+e+'" signatures must be "'+2*o+'" bytes, saw "'+a+'"');var t=countPadding(r,0,o);var s=countPadding(r,o,r.length);var u=o-t;var c=o-s;var v=1+1+u+1+1+c;var d=v<i;var p=n.allocUnsafe((d?2:3)+v);var w=0;p[w++]=l;if(d)p[w++]=v;else{p[w++]=1|i;p[w++]=255&v}p[w++]=g;p[w++]=u;if(t<0){p[w++]=0;w+=r.copy(p,w,0,o)}else w+=r.copy(p,w,t,o);p[w++]=g;p[w++]=c;if(s<0){p[w++]=0;r.copy(p,w,o)}else r.copy(p,w,o+s);return p}t={derToJose:derToJose,joseToDer:joseToDer};var d=t;const p=t.derToJose,w=t.joseToDer;export default d;export{p as derToJose,w as joseToDer};

