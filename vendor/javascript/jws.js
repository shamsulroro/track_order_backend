import e from"safe-buffer";import r from"stream";import t from"util";import"process";import{_ as i,a,b as s}from"./_/bfc64590.js";import n from"jwa";import"buffer";var o="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var f={};var u=e.Buffer;var c=i;var l=n;var d=r;var h=a;var m=t;var S=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}function safeJsonParse(e){if(isObject(e))return e;try{return JSON.parse(e)}catch(e){return}}function headerFromJWS(e){var r=e.split(".",1)[0];return safeJsonParse(u.from(r,"base64").toString("binary"))}function securedInputFromJWS(e){return e.split(".",2).join(".")}function signatureFromJWS(e){return e.split(".")[2]}function payloadFromJWS(e,r){r=r||"utf8";var t=e.split(".")[1];return u.from(t,"base64").toString(r)}function isValidJws(e){return S.test(e)&&!!headerFromJWS(e)}function jwsVerify(e,r,t){if(!r){var i=new Error("Missing algorithm parameter for jws.verify");i.code="MISSING_ALGORITHM";throw i}e=h(e);var a=signatureFromJWS(e);var s=securedInputFromJWS(e);var n=l(r);return n.verify(s,a,t)}function jwsDecode(e,r){r=r||{};e=h(e);if(!isValidJws(e))return null;var t=headerFromJWS(e);if(!t)return null;var i=payloadFromJWS(e);("JWT"===t.typ||r.json)&&(i=JSON.parse(i,r.encoding));return{header:t,payload:i,signature:signatureFromJWS(e)}}function VerifyStream(e){e=e||{};var r=e.secret||e.publicKey||e.key;var t=new c(r);(this||o).readable=true;(this||o).algorithm=e.algorithm;(this||o).encoding=e.encoding;(this||o).secret=(this||o).publicKey=(this||o).key=t;(this||o).signature=new c(e.signature);(this||o).secret.once("close",function(){!(this||o).signature.writable&&(this||o).readable&&this.verify()}.bind(this||o));(this||o).signature.once("close",function(){!(this||o).secret.writable&&(this||o).readable&&this.verify()}.bind(this||o))}m.inherits(VerifyStream,d);VerifyStream.prototype.verify=function verify(){try{var e=jwsVerify((this||o).signature.buffer,(this||o).algorithm,(this||o).key.buffer);var r=jwsDecode((this||o).signature.buffer,(this||o).encoding);this.emit("done",e,r);this.emit("data",e);this.emit("end");(this||o).readable=false;return e}catch(e){(this||o).readable=false;this.emit("error",e);this.emit("close")}};VerifyStream.decode=jwsDecode;VerifyStream.isValid=isValidJws;VerifyStream.verify=jwsVerify;f=VerifyStream;var y=f;var v={};var g=s;var p=y;var b=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];v.ALGORITHMS=b;v.sign=g.sign;v.verify=p.verify;v.decode=p.decode;v.isValid=p.isValid;v.createSign=function createSign(e){return new g(e)};v.createVerify=function createVerify(e){return new p(e)};const V=v.sign,w=v.verify,J=v.decode,j=v.isValid,W=v.createSign,F=v.createVerify;const O=v.ALGORITHMS;export default v;export{O as ALGORITHMS,W as createSign,F as createVerify,J as decode,j as isValid,V as sign,w as verify};

